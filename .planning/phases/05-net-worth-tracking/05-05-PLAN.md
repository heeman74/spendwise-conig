---
phase: 05-net-worth-tracking
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - spendwise-api/src/schema/typeDefs/account.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Toggling an account off dims the card and the net worth hero value updates to exclude that account"
    - "Credit card accounts are listed under Liabilities in the account breakdown"
  artifacts:
    - path: "spendwise-api/src/schema/typeDefs/account.ts"
      provides: "Account GraphQL type with includeInNetWorth field"
      contains: "includeInNetWorth"
  key_links:
    - from: "spendwise/src/graphql/mutations/netWorth.ts"
      to: "spendwise-api/src/schema/typeDefs/account.ts"
      via: "toggleIncludeInNetWorth mutation returns Account! type"
      pattern: "includeInNetWorth: Boolean"
---

<objective>
Fix Account GraphQL type to include includeInNetWorth field, unblocking the toggle switch and liabilities display.

Purpose: The toggleIncludeInNetWorth mutation returns Account! type, and the frontend requests includeInNetWorth on it. The Account GraphQL type is missing this field, causing a GraphQL validation error. This single missing field causes both test 5 (toggle not working) and test 9 (liabilities not showing) failures.

Output: Working account toggle and proper liabilities display in net worth page.
</objective>

<execution_context>
@/Users/heechung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/heechung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@spendwise-api/src/schema/typeDefs/account.ts
@spendwise-api/src/schema/typeDefs/netWorth.ts
@spendwise/src/graphql/mutations/netWorth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add includeInNetWorth field to Account GraphQL type and verify database schema</name>
  <files>spendwise-api/src/schema/typeDefs/account.ts</files>
  <action>
Add `includeInNetWorth: Boolean!` to the Account type definition in `spendwise-api/src/schema/typeDefs/account.ts`. Place it after the `institution: String!` field (line 10) and before `lastSynced: DateTime` (line 11).

The updated Account type should look like:
```
type Account {
  id: ID!
  userId: String!
  name: String!
  type: AccountType!
  balance: Decimal!
  institution: String!
  includeInNetWorth: Boolean!
  lastSynced: DateTime
  transactions(pagination: PaginationInput): TransactionConnection!
  createdAt: DateTime!
  updatedAt: DateTime!
}
```

This is the ONLY file change needed. The field already exists in:
- Prisma schema (both spendwise/ and spendwise-api/ at line 55: `includeInNetWorth Boolean @default(true)`)
- NetWorth resolver (returns `account.includeInNetWorth` at line 169)
- AccountNetWorth GraphQL type (line 23 in netWorth.ts typeDefs)
- Frontend mutation (requests `includeInNetWorth` at line 7 of mutations/netWorth.ts)

After the file change, verify the database column exists by running:
```bash
cd spendwise-api && npx prisma db push --accept-data-loss 2>&1 | tail -5
```

Then verify the API compiles:
```bash
cd spendwise-api && npx tsc --noEmit
```
  </action>
  <verify>
1. `cd spendwise-api && npx tsc --noEmit` completes with no errors
2. Grep confirms the field exists: `grep "includeInNetWorth" spendwise-api/src/schema/typeDefs/account.ts`
3. `cd spendwise-api && npx prisma db push` confirms schema is in sync
  </verify>
  <done>
Account GraphQL type includes includeInNetWorth: Boolean! field. The toggleIncludeInNetWorth mutation can now return this field without GraphQL validation error. API compiles successfully. Database schema is in sync.
  </done>
</task>

</tasks>

<verification>
1. `grep "includeInNetWorth" spendwise-api/src/schema/typeDefs/account.ts` shows the field
2. `cd spendwise-api && npx tsc --noEmit` passes
3. Start API server and test mutation via GraphQL playground or curl:
   - toggleIncludeInNetWorth mutation should return Account with includeInNetWorth field
   - netWorth query should return accounts with proper asset/liability breakdown
</verification>

<success_criteria>
- Account GraphQL type definition includes `includeInNetWorth: Boolean!`
- API TypeScript compilation succeeds
- Database schema is synchronized (db:push confirms no changes needed)
- UAT tests 5 (toggle) and 9 (liabilities) root causes are resolved
</success_criteria>

<output>
After completion, create `.planning/phases/05-net-worth-tracking/05-05-SUMMARY.md`
</output>
