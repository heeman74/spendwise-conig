---
phase: 05-net-worth-tracking
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - spendwise/src/graphql/queries/netWorth.ts
  - spendwise/src/graphql/queries/index.ts
  - spendwise/src/graphql/mutations/netWorth.ts
  - spendwise/src/graphql/mutations/index.ts
  - spendwise/src/hooks/useNetWorth.ts
  - spendwise/src/hooks/index.ts
  - spendwise/src/components/net-worth/NetWorthHero.tsx
  - spendwise/src/components/charts/NetWorthChart.tsx
  - spendwise/src/components/net-worth/AccountBreakdown.tsx
  - spendwise/src/components/net-worth/AccountCard.tsx
  - spendwise/src/app/(dashboard)/net-worth/page.tsx
  - spendwise/src/components/layout/Sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to /net-worth page from sidebar (appears after Recurring)"
    - "Net worth page shows hero number with current net worth, month-over-month change, and period change"
    - "Net worth page shows historical line chart with time range selector (1M, 3M, 6M, 1Y, All)"
    - "Chart color is green for positive trend, red for negative trend"
    - "Account breakdown shows assets and liabilities sections with subtotals"
    - "Each account card shows name, type, balance, percentage of total, and mini sparkline"
    - "User can toggle 'include in net worth' per account directly on the net worth page"
    - "Empty state shows $0 net worth with guidance to add accounts"
    - "Desktop: chart and breakdown side-by-side; mobile: stacked"
  artifacts:
    - path: "spendwise/src/app/(dashboard)/net-worth/page.tsx"
      provides: "Dedicated net worth page"
      min_lines: 30
    - path: "spendwise/src/components/net-worth/NetWorthHero.tsx"
      provides: "Hero section with current net worth and change indicators"
      min_lines: 20
    - path: "spendwise/src/components/charts/NetWorthChart.tsx"
      provides: "Historical line chart with time range selector"
      min_lines: 40
    - path: "spendwise/src/components/net-worth/AccountBreakdown.tsx"
      provides: "Assets and liabilities grouped account list"
      min_lines: 30
    - path: "spendwise/src/components/net-worth/AccountCard.tsx"
      provides: "Individual account card with sparkline"
      min_lines: 20
    - path: "spendwise/src/hooks/useNetWorth.ts"
      provides: "GraphQL hooks for net worth data"
      exports: ["useNetWorth", "useToggleIncludeInNetWorth", "useBackfillSnapshots"]
  key_links:
    - from: "spendwise/src/app/(dashboard)/net-worth/page.tsx"
      to: "spendwise/src/hooks/useNetWorth.ts"
      via: "useNetWorth hook call"
      pattern: "useNetWorth"
    - from: "spendwise/src/hooks/useNetWorth.ts"
      to: "spendwise/src/graphql/queries/netWorth.ts"
      via: "Apollo useQuery with GET_NET_WORTH"
      pattern: "useQuery.*GET_NET_WORTH"
    - from: "spendwise/src/components/net-worth/AccountCard.tsx"
      to: "useToggleIncludeInNetWorth"
      via: "Toggle callback prop from parent"
      pattern: "onToggleInclude"
---

<objective>
Build the complete /net-worth page with all frontend components: hero section, historical chart with time range selection, account breakdown with sparklines, and include/exclude toggles. Also create GraphQL query/mutation definitions and custom hooks.

Purpose: This is the main user-facing deliverable â€” the page where users see and interact with their net worth data.
Output: Fully functional /net-worth page accessible from sidebar navigation.
</objective>

<execution_context>
@/Users/heechung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/heechung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-net-worth-tracking/05-RESEARCH.md
@.planning/phases/05-net-worth-tracking/05-CONTEXT.md
@.planning/phases/05-net-worth-tracking/05-02-SUMMARY.md

Key existing files for patterns:
@spendwise/src/hooks/useRecurring.ts (hook pattern with options object)
@spendwise/src/graphql/queries/recurring.ts (query definition pattern)
@spendwise/src/graphql/mutations/recurring.ts (mutation definition pattern)
@spendwise/src/app/(dashboard)/recurring/page.tsx (page composition pattern)
@spendwise/src/components/charts/TrendLineChart.tsx (Recharts pattern)
@spendwise/src/components/layout/Sidebar.tsx (nav item pattern)
@spendwise/src/components/ui/Card.tsx (card component)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GraphQL definitions and useNetWorth hook</name>
  <files>
    spendwise/src/graphql/queries/netWorth.ts
    spendwise/src/graphql/queries/index.ts
    spendwise/src/graphql/mutations/netWorth.ts
    spendwise/src/graphql/mutations/index.ts
    spendwise/src/hooks/useNetWorth.ts
    spendwise/src/hooks/index.ts
  </files>
  <action>
    1. Create `spendwise/src/graphql/queries/netWorth.ts`:
    ```typescript
    import { gql } from '@apollo/client';

    export const GET_NET_WORTH = gql`
      query GetNetWorth($timeRange: TimeRange, $accountIds: [String!]) {
        netWorth(timeRange: $timeRange, accountIds: $accountIds) {
          current
          monthOverMonthChange
          monthOverMonthChangePercent
          periodChange
          periodChangePercent
          totalAssets
          totalLiabilities
          history {
            date
            value
          }
          accounts {
            accountId
            accountName
            accountType
            balance
            percentOfTotal
            includeInNetWorth
            history {
              date
              value
            }
          }
        }
      }
    `;
    ```

    2. Create `spendwise/src/graphql/mutations/netWorth.ts`:
    ```typescript
    import { gql } from '@apollo/client';

    export const TOGGLE_INCLUDE_IN_NET_WORTH = gql`
      mutation ToggleIncludeInNetWorth($accountId: String!) {
        toggleIncludeInNetWorth(accountId: $accountId) {
          id
          includeInNetWorth
        }
      }
    `;

    export const BACKFILL_NET_WORTH_SNAPSHOTS = gql`
      mutation BackfillNetWorthSnapshots {
        backfillNetWorthSnapshots
      }
    `;
    ```

    3. Update barrel files:
    - Add `export * from './netWorth';` to `spendwise/src/graphql/queries/index.ts`
    - Add `export * from './netWorth';` to `spendwise/src/graphql/mutations/index.ts`

    4. Create `spendwise/src/hooks/useNetWorth.ts`:

    Follow the options-object pattern from useRecurring.ts.

    ```typescript
    'use client';
    ```

    - `useNetWorth(options?: { timeRange?: string; accountIds?: string[]; skip?: boolean })`:
      - Uses `useQuery(GET_NET_WORTH, { variables: { timeRange, accountIds }, fetchPolicy: 'cache-and-network', skip })`
      - Returns `{ netWorth: data?.netWorth, loading, error, refetch }`

    - `useToggleIncludeInNetWorth()`:
      - Uses `useMutation(TOGGLE_INCLUDE_IN_NET_WORTH, { refetchQueries: [GET_NET_WORTH] })`
      - Use document-based refetchQueries (NOT string operation names) per Phase 4 decision
      - Returns `{ toggleInclude, loading, error }`

    - `useBackfillSnapshots()`:
      - Uses `useMutation(BACKFILL_NET_WORTH_SNAPSHOTS, { refetchQueries: [GET_NET_WORTH] })`
      - Returns `{ backfill, loading, error }`

    5. Add `export * from './useNetWorth';` to `spendwise/src/hooks/index.ts`

    Map the TimeRange enum to display labels: { ONE_MONTH: '1M', THREE_MONTHS: '3M', SIX_MONTHS: '6M', ONE_YEAR: '1Y', ALL: 'All' }
  </action>
  <verify>
    - `cd spendwise && npx tsc --noEmit` compiles without errors
    - GET_NET_WORTH query is exported from graphql barrel
    - useNetWorth hook is exported from hooks barrel
  </verify>
  <done>
    Frontend data layer complete: GraphQL queries/mutations defined, custom hooks with options-object pattern, document-based refetchQueries.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build net worth page with all components</name>
  <files>
    spendwise/src/components/net-worth/NetWorthHero.tsx
    spendwise/src/components/charts/NetWorthChart.tsx
    spendwise/src/components/net-worth/AccountBreakdown.tsx
    spendwise/src/components/net-worth/AccountCard.tsx
    spendwise/src/app/(dashboard)/net-worth/page.tsx
    spendwise/src/components/layout/Sidebar.tsx
  </files>
  <action>
    Create the following components. All must use 'use client' directive. Follow existing Tailwind CSS patterns from the codebase.

    **1. NetWorthHero.tsx** (`spendwise/src/components/net-worth/`):
    - Hero display showing:
      - Large formatted net worth number (use formatCurrency or similar pattern from existing code)
      - Month-over-month change: amount + percentage, green if positive, red if negative, with up/down arrow
      - Period change (matching selected time range): amount + percentage, same color coding
    - Props: `{ current, monthOverMonthChange, monthOverMonthChangePercent, periodChange, periodChangePercent, timeRangeLabel }`
    - Use existing Card component as container

    **2. NetWorthChart.tsx** (`spendwise/src/components/charts/`):
    - Follow the existing TrendLineChart.tsx pattern for Recharts usage
    - Line chart with:
      - XAxis (date), YAxis (currency formatted), CartesianGrid, Tooltip
      - Single Line for net worth value
      - Stroke color: green (#10b981) for positive trend, red (#ef4444) for negative
    - Time range selector row above chart: buttons for 1M, 3M, 6M, 1Y, All
      - Active button gets primary style (blue bg, white text)
      - Inactive buttons get secondary style (gray bg)
    - Props: `{ data: { date: string; value: number }[], timeRange, onTimeRangeChange }`
    - Implement adaptive granularity:
      - 1M, 3M: show all daily data points
      - 6M: sample weekly (first data point of each week)
      - 1Y, All: sample monthly (first data point of each month)
    - Use ResponsiveContainer width="100%" height={400}
    - Format tooltip values as currency
    - Format X-axis dates based on time range (MMM dd for short, MMM yyyy for long)

    **3. AccountBreakdown.tsx** (`spendwise/src/components/net-worth/`):
    - Two sections: "Assets" and "Liabilities"
    - Each section header shows section name and subtotal
    - Assets section: accounts with type CHECKING, SAVINGS, INVESTMENT
    - Liabilities section: accounts with type CREDIT
    - Each account rendered as AccountCard
    - Props: `{ accounts: AccountNetWorth[], onToggleInclude: (accountId: string) => void }`
    - All accounts shown regardless of balance ($0 accounts visible)

    **4. AccountCard.tsx** (`spendwise/src/components/net-worth/`):
    - Card showing: account name, account type badge, formatted balance, percentage of total net worth
    - Mini sparkline using Recharts LineChart (40px height, no axes/grid/tooltip, dot={false}, isAnimationActive={false})
    - Sparkline stroke color: #3b82f6 (blue)
    - "Include in net worth" toggle switch (checkbox or toggle button)
    - Excluded accounts shown with reduced opacity (opacity-50)
    - Props: `{ account: AccountNetWorth, onToggleInclude: (accountId: string) => void }`

    **5. /net-worth page** (`spendwise/src/app/(dashboard)/net-worth/page.tsx`):
    - 'use client' directive
    - State: `timeRange` (default 'ONE_MONTH'), managed with useState
    - Call `useNetWorth({ timeRange })`
    - Call `useToggleIncludeInNetWorth()` for toggle handler
    - Layout:
      - Page header: "Net Worth" title + "Track your total net worth across all accounts" subtitle
      - NetWorthHero component
      - Grid layout: `grid grid-cols-1 lg:grid-cols-3 gap-6`
        - Chart takes `lg:col-span-2`
        - AccountBreakdown takes `lg:col-span-1`
      - On mobile: chart stacks above breakdown
    - Loading state: show Spinner centered (follow dashboard pattern)
    - Error state: show error message
    - Empty state (no accounts or $0): show page with $0 net worth and note "Add accounts to start tracking your net worth"
    - Handle backfill: if no history data but accounts exist, show a "Generate historical data" button that calls backfillSnapshots mutation

    **6. Sidebar nav update** (`spendwise/src/components/layout/Sidebar.tsx`):
    - Add "Net Worth" nav item AFTER "Recurring" and BEFORE "Accounts"
    - Use a chart/trending-up icon (svg) consistent with sidebar style
    - href: '/net-worth'

    IMPORTANT layout decisions from CONTEXT.md:
    - Chart and breakdown side-by-side on desktop, stacked on mobile
    - Green for positive trend, red for negative
    - All accounts shown regardless of balance
    - Empty state shows page normally with $0
  </action>
  <verify>
    - `cd spendwise && npx tsc --noEmit` compiles without errors
    - `cd spendwise && npm run build` completes without errors
    - /net-worth page exists in the app router
    - Sidebar includes "Net Worth" nav item between "Recurring" and "Accounts"
    - All 4 components exist in their directories
  </verify>
  <done>
    Complete /net-worth page with hero section, historical chart with time range selection, account breakdown with sparklines and toggles, and sidebar navigation. Desktop shows side-by-side layout, mobile stacks vertically.
  </done>
</task>

</tasks>

<verification>
1. `cd spendwise && npx tsc --noEmit` compiles without errors
2. `cd spendwise && npm run build` succeeds
3. Sidebar shows "Net Worth" item between "Recurring" and "Accounts"
4. /net-worth page renders with hero, chart, and breakdown sections
5. Time range selector has 5 options (1M, 3M, 6M, 1Y, All)
6. Account cards show sparklines and include/exclude toggles
</verification>

<success_criteria>
- /net-worth page is accessible and renders all sections
- Hero shows current net worth with both change indicators
- Chart displays historical data with adaptive granularity
- Chart color reflects trend direction (green positive, red negative)
- Account breakdown groups assets and liabilities with subtotals
- Account cards show sparklines and toggles
- Sidebar navigation includes Net Worth link
- Empty state handles gracefully with $0 display
- Mobile layout stacks chart above breakdown
</success_criteria>

<output>
After completion, create `.planning/phases/05-net-worth-tracking/05-03-SUMMARY.md`
</output>
