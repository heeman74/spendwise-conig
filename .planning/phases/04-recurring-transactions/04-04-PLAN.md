---
phase: 04-recurring-transactions
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - spendwise/src/components/transactions/TransactionItem.tsx
  - spendwise/src/components/transactions/TransactionList.tsx
  - spendwise/src/components/transactions/MarkAsRecurringModal.tsx
  - spendwise/src/app/(dashboard)/transactions/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can click a 'Mark as Recurring' button on any transaction row in the transactions page"
    - "Clicking 'Mark as Recurring' opens a modal pre-filled with the transaction's merchant, amount, category, and date"
    - "User selects a frequency and submits to create a recurring transaction entry"
    - "After submission, the recurring item appears on the /recurring page"
  artifacts:
    - path: "spendwise/src/components/transactions/MarkAsRecurringModal.tsx"
      provides: "Frequency selection modal pre-filled with transaction data"
      min_lines: 60
    - path: "spendwise/src/components/transactions/TransactionItem.tsx"
      provides: "Mark as Recurring action button on each transaction row"
      contains: "onMarkRecurring"
    - path: "spendwise/src/app/(dashboard)/transactions/page.tsx"
      provides: "Handler wiring useAddRecurring hook to modal"
      contains: "useAddRecurring"
  key_links:
    - from: "spendwise/src/components/transactions/TransactionItem.tsx"
      to: "spendwise/src/app/(dashboard)/transactions/page.tsx"
      via: "onMarkRecurring callback prop"
      pattern: "onMarkRecurring"
    - from: "spendwise/src/app/(dashboard)/transactions/page.tsx"
      to: "spendwise/src/hooks/useRecurring.ts"
      via: "useAddRecurring hook"
      pattern: "useAddRecurring"
---

<objective>
Add "Mark as Recurring" action to transaction rows so users can create recurring transaction entries directly from the transactions page.

Purpose: Users identified during UAT that there's no way to mark a transaction as recurring from the transactions page. The addRecurring mutation and useAddRecurring hook exist and work, but there's no UI entry point from transactions.

Output: A recurring action button on each transaction row, a lightweight frequency selection modal pre-filled with transaction data, and wiring to the existing useAddRecurring hook.
</objective>

<execution_context>
@/Users/heechung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/heechung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-recurring-transactions/04-03-SUMMARY.md
@spendwise/src/components/transactions/TransactionItem.tsx
@spendwise/src/components/transactions/TransactionList.tsx
@spendwise/src/app/(dashboard)/transactions/page.tsx
@spendwise/src/hooks/useRecurring.ts
@spendwise/src/components/recurring/AddRecurringModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Mark as Recurring button to TransactionItem and pass callback through TransactionList</name>
  <files>
    spendwise/src/components/transactions/TransactionItem.tsx
    spendwise/src/components/transactions/TransactionList.tsx
  </files>
  <action>
    In TransactionItem.tsx:
    1. Add `onMarkRecurring?: (transaction: Transaction) => void` to TransactionItemProps interface
    2. Add a third action button between edit and delete in the actions cell. Use a refresh/repeat icon (SVG path: "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15") to represent "recurring"
    3. Style the button the same way as edit (variant="ghost", size="sm", className="p-1") with a blue-ish color: `text-primary-600 hover:text-primary-700 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/20`
    4. Add a title attribute "Mark as recurring" for accessibility
    5. onClick calls `onMarkRecurring(transaction)`

    In TransactionList.tsx:
    1. Add `onMarkRecurring?: (transaction: Transaction) => void` to TransactionListProps interface
    2. Pass `onMarkRecurring` through to each TransactionItem in the map
  </action>
  <verify>
    Run `cd /Users/heechung/projects/spendwise && npx tsc --noEmit 2>&1 | grep -i "TransactionItem\|TransactionList" | head -20` to check for type errors in modified files. Should show no errors or only pre-existing ones.
  </verify>
  <done>
    TransactionItem renders a recurring icon button in the actions column. TransactionList passes the onMarkRecurring callback through to each item. Both components accept the new optional prop without breaking existing usage.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MarkAsRecurringModal and wire it into transactions page</name>
  <files>
    spendwise/src/components/transactions/MarkAsRecurringModal.tsx
    spendwise/src/app/(dashboard)/transactions/page.tsx
  </files>
  <action>
    Create MarkAsRecurringModal.tsx:
    1. Props: `isOpen: boolean`, `onClose: () => void`, `transaction: Transaction | null`, `onSubmit: (data) => Promise<void>`, `loading: boolean`
    2. Use the same modal pattern as AddRecurringModal (fixed overlay + centered card, not the Modal component) for consistency
    3. Pre-fill from transaction prop: merchant name (read-only display), amount (read-only display), category (read-only display), date as firstDate (read-only display)
    4. Only editable field: Frequency dropdown with same FREQUENCY_OPTIONS as AddRecurringModal (WEEKLY, BIWEEKLY, MONTHLY, QUARTERLY, ANNUAL), defaulting to MONTHLY
    5. Show transaction details at top as a summary card (merchant, amount, category) so user sees what they're marking
    6. Submit and Cancel buttons at bottom. Submit calls onSubmit with: `{ merchantName: transaction.merchant || transaction.description || transaction.category, amount: Math.abs(transaction.amount), frequency: selectedFrequency, category: transaction.category, firstDate: transaction date as YYYY-MM-DD string }`
    7. Reset frequency to MONTHLY on close
    8. Return null if !isOpen or !transaction

    Wire into transactions/page.tsx:
    1. Import `useAddRecurring` from `@/hooks/useRecurring`
    2. Import `MarkAsRecurringModal` from `@/components/transactions/MarkAsRecurringModal`
    3. Add state: `const [markRecurringTransaction, setMarkRecurringTransaction] = useState<Transaction | null>(null)`
    4. Add: `const { addRecurring, loading: addRecurringLoading } = useAddRecurring()`
    5. Create handler: `const handleMarkRecurring = (transaction: Transaction) => { setMarkRecurringTransaction(transaction); }`
    6. Create submit handler: `const handleMarkRecurringSubmit = async (data) => { await addRecurring(data); setMarkRecurringTransaction(null); }` â€” wrap in try/catch
    7. Pass `onMarkRecurring={handleMarkRecurring}` to both TransactionList instances (all tab and review tab)
    8. Add MarkAsRecurringModal at bottom of JSX, after the existing Add/Edit modal: `<MarkAsRecurringModal isOpen={!!markRecurringTransaction} onClose={() => setMarkRecurringTransaction(null)} transaction={markRecurringTransaction} onSubmit={handleMarkRecurringSubmit} loading={addRecurringLoading} />`
  </action>
  <verify>
    Run `cd /Users/heechung/projects/spendwise && npm run build 2>&1 | tail -20` to verify build passes.
    Check the transactions page loads: the recurring icon button should appear on each transaction row, and clicking it should open the frequency selection modal.
  </verify>
  <done>
    Users can click a recurring icon on any transaction row. A modal opens showing the transaction details and a frequency selector. Submitting creates the recurring entry via the addRecurring mutation. The modal closes and resets after submission.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/heechung/projects/spendwise && npm run build` passes without errors
2. Navigate to /transactions page - each transaction row shows 3 action buttons (edit, recurring, delete)
3. Click the recurring icon on a transaction - modal opens with pre-filled merchant, amount, category
4. Select a frequency and submit - modal closes, item appears on /recurring page
5. TypeScript compilation: no new type errors
</verification>

<success_criteria>
- TransactionItem shows "Mark as Recurring" button alongside edit and delete
- Clicking the button opens a modal pre-filled with transaction data
- Only frequency needs to be selected by the user
- Submitting creates a recurring transaction entry via addRecurring mutation
- Build passes, no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-recurring-transactions/04-04-SUMMARY.md`
</output>
