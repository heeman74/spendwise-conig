---
phase: 06-investment-portfolio
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - spendwise/src/app/(dashboard)/investments/page.tsx
  - spendwise/src/components/portfolio/PortfolioSummary.tsx
  - spendwise/src/components/portfolio/HoldingsTable.tsx
  - spendwise/src/components/charts/AssetAllocationChart.tsx
  - spendwise/src/components/layout/Sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can view portfolio page at /investments showing total portfolio value, total gain/loss, and gain percentage"
    - "User can view asset allocation breakdown as a donut pie chart with color-coded asset types"
    - "User can view individual holdings in a sortable table showing security name, ticker, shares, price, value, cost basis, and gain/loss"
    - "Portfolio page shows empty state when no investment holdings exist"
    - "Holdings with no cost basis show dash instead of gain/loss values"
    - "Sidebar Investments link uses a distinct chart-bar icon (not duplicate of Net Worth icon)"
  artifacts:
    - path: "spendwise/src/app/(dashboard)/investments/page.tsx"
      provides: "Portfolio page with summary, allocation chart, and holdings table"
      contains: "usePortfolio"
    - path: "spendwise/src/components/portfolio/PortfolioSummary.tsx"
      provides: "Portfolio summary hero component showing total value and gains"
      contains: "formatCurrency"
    - path: "spendwise/src/components/portfolio/HoldingsTable.tsx"
      provides: "Sortable holdings table with security details and unrealized gains"
      contains: "sortedHoldings"
    - path: "spendwise/src/components/charts/AssetAllocationChart.tsx"
      provides: "Recharts donut pie chart for asset allocation breakdown"
      contains: "PieChart"
  key_links:
    - from: "spendwise/src/app/(dashboard)/investments/page.tsx"
      to: "spendwise/src/hooks/usePortfolio.ts"
      via: "hook imports for data fetching"
      pattern: "usePortfolio|useAssetAllocation|useHoldings"
    - from: "spendwise/src/components/charts/AssetAllocationChart.tsx"
      to: "recharts"
      via: "PieChart, Pie, Cell, ResponsiveContainer imports"
      pattern: "import.*recharts"
---

<objective>
Build the portfolio page UI with three components: PortfolioSummary (hero with total value + gains), AssetAllocationChart (donut pie chart), and HoldingsTable (sortable table with gains). Replace the existing mock investments page.

Purpose: This is the primary user-facing feature — where users see their investment holdings, allocation, and performance. Fulfills INVS-01, INVS-02, INVS-03, INVS-05.
Output: Working portfolio page at /investments with three domain components.
</objective>

<execution_context>
@/Users/heechung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/heechung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-investment-portfolio/06-02-SUMMARY.md
@spendwise/src/app/(dashboard)/net-worth/page.tsx
@spendwise/src/components/charts/SpendingPieChart.tsx
@spendwise/src/components/net-worth/NetWorthHero.tsx
@spendwise/src/components/layout/Sidebar.tsx
@spendwise/src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PortfolioSummary and AssetAllocationChart components</name>
  <files>
    spendwise/src/components/portfolio/PortfolioSummary.tsx
    spendwise/src/components/charts/AssetAllocationChart.tsx
  </files>
  <action>
**Create `spendwise/src/components/portfolio/PortfolioSummary.tsx`:**

Follow the pattern from `NetWorthHero.tsx`. This is a hero section displaying portfolio totals.

Props interface:
```typescript
interface PortfolioSummaryProps {
  totalValue: number;
  totalCostBasis: number;
  totalGain: number;
  totalGainPercent: number;
  holdingCount: number;
  accountCount: number;
}
```

Component layout:
- `'use client'` directive
- Import `formatCurrency` and `cn` from `@/lib/utils`
- Main container: `bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6`
- Row 1: Total Portfolio Value as large text (`text-3xl font-bold`) with label above
- Row 2: Total gain/loss with color coding (green if positive, red if negative), show as `+$X,XXX.XX (+X.XX%)` or `-$X,XXX.XX (-X.XX%)`
- Row 3: Grid of 3 stat boxes (cost basis, holdings count, accounts count) with subtle gray background

**Create `spendwise/src/components/charts/AssetAllocationChart.tsx`:**

Follow the exact pattern from `SpendingPieChart.tsx`:

Props interface:
```typescript
interface AssetAllocationChartProps {
  data: Array<{
    type: string;
    value: number;
    percentage: number;
    color: string;
  }>;
  loading?: boolean;
}
```

Component:
- `'use client'` directive
- Import `PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip` from `recharts`
- Import `formatCurrency` from `@/lib/utils`
- Import Card from `@/components/ui/Card`
- Wrap in Card with title "Asset Allocation"
- If loading, show spinner inside card
- If no data or empty array, show "No allocation data available" centered message
- Donut chart (innerRadius=60, outerRadius=100, paddingAngle=2)
- dataKey="value", nameKey="type"
- Custom tooltip showing type name, value formatted as currency, and percentage
- Vertical legend on right showing type names
- Use colors from data (backend provides them)
- Chart height: 300px
  </action>
  <verify>Run `cd /Users/heechung/projects/spendwise && npx tsc --noEmit` to check for TypeScript errors.</verify>
  <done>PortfolioSummary shows total value, gain/loss with color coding, and stat boxes. AssetAllocationChart renders Recharts donut pie chart with custom tooltip and legend.</done>
</task>

<task type="auto">
  <name>Task 2: Create HoldingsTable, replace investments page, fix Sidebar icon</name>
  <files>
    spendwise/src/components/portfolio/HoldingsTable.tsx
    spendwise/src/app/(dashboard)/investments/page.tsx
    spendwise/src/components/layout/Sidebar.tsx
  </files>
  <action>
**Create `spendwise/src/components/portfolio/HoldingsTable.tsx`:**

Props interface:
```typescript
interface Holding {
  id: string;
  security: {
    id: string;
    name: string;
    tickerSymbol: string | null;
    type: string;
  };
  quantity: number;
  institutionPrice: number;
  institutionValue: number;
  costBasis: number | null;
  unrealizedGain: number;
  unrealizedGainPercent: number;
}

interface HoldingsTableProps {
  holdings: Holding[];
  loading?: boolean;
}
```

Component:
- `'use client'` directive
- Import useState, Card, formatCurrency, cn, Spinner
- Sortable table with columns: Security, Shares, Price, Value, Cost Basis, Gain/Loss
- Sort state: `sortField` (default 'institutionValue') and `sortDirection` (default 'desc')
- Click column header to toggle sort
- If loading, show spinner inside Card
- Empty state: "No holdings found" centered message inside Card
- Security column: Show tickerSymbol in bold if available, else name. Below it show security type in small gray text.
- Shares column: Format to 4 decimal places
- Price, Value columns: formatCurrency
- Cost Basis column: If null show "—" (em dash), else formatCurrency
- Gain/Loss column: If costBasis is null, show "—". Otherwise color-code: green for positive (text-green-600), red for negative (text-red-600). Show value on first line, percentage in small text below: `(+X.XX%)` or `(-X.XX%)`
- Table classes follow existing patterns: `w-full`, `divide-y`, `hover:bg-gray-50`

**Replace `spendwise/src/app/(dashboard)/investments/page.tsx`:**

Completely replace the existing mock page. Follow the `net-worth/page.tsx` pattern:

```typescript
'use client';

import PortfolioSummary from '@/components/portfolio/PortfolioSummary';
import AssetAllocationChart from '@/components/charts/AssetAllocationChart';
import HoldingsTable from '@/components/portfolio/HoldingsTable';
import { usePortfolio, useAssetAllocation, useHoldings } from '@/hooks/usePortfolio';
```

Page structure:
- Page header: "Investment Portfolio" title, "View your investment holdings with performance and allocation insights" subtitle
- Loading state: When `portfolioLoading && !portfolio`, show "Loading portfolio data..." centered
- Error state: Red banner "Failed to load portfolio data. Please try again."
- Empty state (when holdingCount is 0 or no portfolio data): Show stock chart SVG icon + "No Investment Holdings" title + "Upload a brokerage statement or add holdings manually to start tracking your portfolio" subtitle. Use same card styling as net-worth empty state.
- Normal state: Grid layout
  - PortfolioSummary component at top (full width)
  - Below: `grid grid-cols-1 lg:grid-cols-3 gap-6`
    - AssetAllocationChart in `lg:col-span-1` (left/top on mobile)
    - HoldingsTable in `lg:col-span-2` (right/bottom on mobile)

**Fix Sidebar icon for Investments:**

The current Investments sidebar item uses the same icon path as Net Worth (`M13 7h8m0 0v8m0-8l-8 8-4-4-6 6`). Change it to a chart-bar icon to differentiate:
```
M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z
```
This is a stock chart / candlestick-style icon that represents investments better.
  </action>
  <verify>
Run `cd /Users/heechung/projects/spendwise && npx tsc --noEmit` to check for TypeScript errors.
Run `cd /Users/heechung/projects/spendwise && npm run build` and confirm it builds without errors.
  </verify>
  <done>Portfolio page at /investments shows PortfolioSummary hero, AssetAllocationChart donut, and sortable HoldingsTable. Empty states handled gracefully. Sidebar has distinct icon for Investments.</done>
</task>

</tasks>

<verification>
1. `cd /Users/heechung/projects/spendwise && npx tsc --noEmit` passes
2. `cd /Users/heechung/projects/spendwise && npm run build` succeeds
3. investments/page.tsx imports from usePortfolio hooks (not mock data)
4. PortfolioSummary.tsx renders total value and gain/loss with color coding
5. AssetAllocationChart.tsx renders Recharts PieChart with donut shape
6. HoldingsTable.tsx supports sorting and handles null costBasis with dashes
7. Sidebar.tsx has a distinct icon for Investments (different from Net Worth)
</verification>

<success_criteria>
- /investments page replaced: shows real portfolio data instead of mock advice
- Portfolio summary displays total value, total gain/loss (colored), cost basis, holding count, account count
- Asset allocation pie chart shows color-coded donut with legend and tooltips
- Holdings table is sortable by all numeric columns
- Null cost basis handled: shows "—" instead of $0 or error
- Empty portfolio state shows helpful message
- Loading and error states present
- Sidebar icon differentiated from Net Worth
</success_criteria>

<output>
After completion, create `.planning/phases/06-investment-portfolio/06-03-SUMMARY.md`
</output>
